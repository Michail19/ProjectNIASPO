# Используем базовый образ с Ubuntu
FROM ubuntu:20.04

# Установка переменной окружения для предотвращения интерактивного режима
ENV DEBIAN_FRONTEND=noninteractive

# Настройка временной зоны
RUN apt update && apt install -y tzdata && \
    ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime && \
    dpkg-reconfigure --frontend noninteractive tzdata

# Устанавливаем зависимости
RUN apt-get update && \
    apt-get install -y \
    novnc \
    websockify \
    x11vnc \
    git && \
    apt-get clean

# Устанавливаем зависимости Python для NoVNC
RUN apt update && apt install -y python3 python3-pip

# Установка numpy
RUN pip3 install numpy

# Клонируем конкретный релиз NoVNC для гарантированной структуры
RUN git clone --branch v1.2.0 https://github.com/novnc/noVNC.git /noVNC

# Проверяем структуру каталога
RUN ls -l /noVNC/utils

# Устанавливаем разрешение на запуск для launch.sh
RUN chmod +x /noVNC/utils/launch.sh

# Открываем нужные порты
EXPOSE 5900 6080

# Запуск x11vnc и noVNC
CMD x11vnc -display :0 -forever -shared -rfbport 5900 & \
    /noVNC/utils/launch.sh --vnc localhost:5900 --listen 6080
