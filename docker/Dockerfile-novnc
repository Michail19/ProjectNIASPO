# Используем базовый образ с Ubuntu
FROM ubuntu:20.04

# Установка переменной окружения для предотвращения интерактивного режима
ENV DEBIAN_FRONTEND=noninteractive

# Настройка временной зоны
RUN apt update && apt install -y tzdata && \
    ln -fs /usr/share/zoneinfo/Europe/London /etc/localtime && \
    dpkg-reconfigure --frontend noninteractive tzdata

# Устанавливаем зависимости
RUN apt-get update && \
    apt-get install -y \
    novnc \
    websockify \
    x11vnc \
    git && \
    apt-get clean

# Устанавливаем зависимости Python для NoVNC
RUN apt update && apt install -y python3 python3-pip

# Установка numpy
RUN pip3 install numpy

# Клонирование NoVNC
RUN git clone https://github.com/novnc/noVNC.git /opt/novnc
RUN ln -s /opt/novnc/utils/launch.sh /usr/local/bin/novnc-launch.sh

# Копируем свой скрипт запуска, если он есть
COPY ./docker/launch.sh /app/launch.sh
RUN chmod +x /app/launch.sh

# Открываем нужные порты
EXPOSE 5900 6080

# Запуск x11vnc и noVNC
CMD x11vnc -display :0 -forever -shared -rfbport 5900 & \
    /usr/local/bin/novnc-launch.sh --vnc localhost:5900 --listen 6080
