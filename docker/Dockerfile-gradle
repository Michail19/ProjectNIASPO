# Используем базовый образ с JDK
FROM openjdk:11-jdk-slim

# Устанавливаем нужные пакеты для скачивания и распаковки Gradle
RUN apt-get update && apt-get install -y wget unzip && \
    rm -rf /var/lib/apt/lists/*

# Определяем переменную окружения для Gradle версии
ENV GRADLE_VERSION=7.4.2

# Скачиваем и распаковываем Gradle в /opt/gradle
RUN wget https://services.gradle.org/distributions/gradle-${GRADLE_VERSION}-bin.zip -P /tmp && \
    unzip -d /opt/gradle /tmp/gradle-${GRADLE_VERSION}-bin.zip && \
    rm /tmp/gradle-${GRADLE_VERSION}-bin.zip

# Добавляем Gradle в PATH
ENV GRADLE_HOME=/opt/gradle/gradle-${GRADLE_VERSION}
ENV PATH="${GRADLE_HOME}/bin:${PATH}"

# Устанавливаем рабочую директорию и копируем файлы проекта
WORKDIR /app
COPY . /app

# Проверяем содержимое каталога для диагностики
RUN ls -l /app

# Если gradlew отсутствует, создаем его
RUN gradle wrapper --gradle-version ${GRADLE_VERSION} || gradle init --type java-application

# Убедитесь, что gradlew имеет разрешение на выполнение
RUN chmod +x gradlew

# Запускаем команду для сборки проекта
RUN ./gradlew build
